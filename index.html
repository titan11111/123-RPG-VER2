<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- iOS/レスポンシブ: 拡大防止・1画面収まる・ノッチ/ホームインジケータ余白は viewport-fit=cover + env(safe-area-inset-*) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#00008b">
    <!-- PWA対応 -->
    <link rel="manifest" href="manifest.json">
    <title>魔の山</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="game-container">
    <!-- 壁から差し込む光（室内フィールド時のみ表示） -->
    <div id="light-through-wall" class="light-through-wall" aria-hidden="true"></div>
    <div id="start-screen" class="screen active">
        <!-- 背景画像（モックアップ画像） -->
        <img src="images/openingmokup.png" alt="" class="opening-background">
    </div>

    <div id="prologue-screen" class="screen">
        <div class="ff-window">
            <div style="font-size: 160px; margin-bottom: 20px;">🕴️</div>
            <p id="prologue-text">「わしは王様じゃ。えっと、、、お主は？」</p>
            <p>【Aボタンで名前を教える】</p>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="ff-window" style="margin-bottom:4px;">
            <span id="area-title">場所</span>
        </div>
        <div id="map-grid"></div>
        <div id="town-actions" style="display:none; margin-top: 4px;">
            <div class="ff-window">宿屋があります</div>
        </div>
    </div>

    <div id="battle-screen" class="screen">
        <div id="battle-log">魔物があらわれた！</div>
        <div class="enemy-area">
            <div id="monster-name">モンスター</div>
            <div id="monster-sprite" class="monster-sprite"></div>
            <div id="enemy-hp-bar" class="enemy-hp-bar hp-bar-container" style="display:none;">
                <div id="enemy-hp-bar-fill" class="hp-bar" style="width: 100%;"></div>
                <div id="enemy-hp-bar-text" class="hp-bar-text">HP: 100/100</div>
            </div>
        </div>
        <div class="battle-ui">
            <div class="ff-window command-box">
                <ul id="command-list" style="margin:0; padding:0;">
                    <li id="cmd-attack" data-command="attack"> たたかう</li>
                    <li id="cmd-magic" data-command="magic"> まほう</li>
                    <li id="cmd-item" data-command="item"> アイテム</li>
                    <li id="cmd-escape" data-command="escape"> にげる</li>
                </ul>
                <ul id="magic-list" style="margin:0; padding:0; display:none;">
                    <!-- 魔法リストは動的に生成 -->
                </ul>
            </div>
            <div class="ff-window status-box" id="party-status-area"></div>
        </div>
    </div>

    <div id="ending-screen" class="screen">
        <div class="ff-window">
            <h1 id="ending-title">HAPPY ENDING</h1>
            <p id="ending-msg">仲間と共に世界を救った！</p>
            <p>平和な日々が戻ってきた...</p>
            <p>【Aボタンでタイトルへ】</p>
        </div>
    </div>

    <div id="custom-dialog-overlay">
        <div class="ff-window dialog-content">
            <div id="dialog-message" style="margin-bottom: 20px; line-height: 1.5;"></div>
            <div id="dialog-footer" style="font-size: 12px; color: #ccc;">[ Aボタンで閉じる ]</div>
        </div>
    </div>
    
    <!-- ステータス画面オーバーレイ（Bボタンで表示/非表示） -->
    <div id="status-overlay" class="status-overlay">
        <div class="ff-window status-overlay-content">
            <h2 style="margin-top: 0; margin-bottom: 15px; text-align: center; font-size: 20px;">ステータス</h2>
            <div id="status-overlay-hp" style="margin-bottom: 10px; line-height: 1.6;"></div>
            <div id="status-overlay-party" style="margin-bottom: 10px; line-height: 1.6;"></div>
            <div id="status-overlay-stats" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);"></div>
            <div style="margin-top: 20px; text-align: center; font-size: 12px; color: #ccc;">[ Bボタンで閉じる ]</div>
        </div>
    </div>
</div>

<!-- はい/いいえモーダル（#game-container 外・flex干渉防止） -->
<div id="yes-no-modal-overlay">
    <div class="ff-window">
        <div id="yes-no-message"></div>
        <div class="yes-no-buttons">
            <button id="yes-button" type="button">はい</button>
            <button id="no-button" type="button">いいえ</button>
        </div>
    </div>
</div>

<!-- BGM管理 -->
<audio id="bgm-title" loop preload="auto">
    <source src="audio/title.mp3.mp3" type="audio/mpeg">
    <source src="audio/title.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-prologue" loop preload="auto">
    <source src="audio/prologue.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-town" loop preload="auto">
    <source src="audio/town.mp3" type="audio/mpeg">
    <source src="audio/field.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-field" loop preload="auto">
    <source src="audio/field.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-battle" loop preload="auto">
    <source src="audio/battle.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-boss" loop preload="auto">
    <source src="audio/boss.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-lastboss" loop preload="auto">
    <source src="audio/lassboss.mp3" type="audio/mpeg">
    <source src="audio/boss.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-ending" loop preload="auto">
    <source src="audio/ending.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-catgod" loop preload="auto">
    <source src="audio/catgod.mp3" type="audio/mpeg">
</audio>

<div id="control-panel">
    <div class="d-pad">
        <button class="pad-btn up" onpointerdown="handleMove(0, -1)">▲</button>
        <button class="pad-btn left" onpointerdown="handleMove(-1, 0)">◀</button>
        <button class="pad-btn right" onpointerdown="handleMove(1, 0)">▶</button>
        <button class="pad-btn down" onpointerdown="handleMove(0, 1)">▼</button>
    </div>

    <div class="action-group">
        <button class="circle-btn btn-b" onpointerdown="handleB()">B</button>
        <button class="circle-btn btn-a" onpointerdown="handleA()">A</button>
    </div>
</div>

<!-- JavaScriptファイルの読み込み -->
<!-- 基本設定とゲーム状態 -->
<script src="js/config.js"></script>
<script src="js/gameState.js"></script>

<!-- 音声管理 -->
<script src="js/audio.js"></script>
<script src="js/sfx.js"></script>

<!-- UI管理 -->
<script src="js/ui.js"></script>

<!-- SVG生成 -->
<script src="js/sprites/svgGenerator.js"></script>

<!-- マップ関連（依存関係順） -->
<script src="js/map/allyManager.js"></script>
<script src="js/map/movement.js"></script>
<script src="js/map/tileEvents.js"></script>
<script src="js/map/npcManager.js"></script>
<script src="js/map/worldTransition.js"></script>
<script src="js/map/mapRenderer.js"></script>

<!-- 戦闘関連（依存関係順） -->
<script src="js/battle/statusEffects.js"></script>
<script src="js/battle/damageSystem.js"></script>
<script src="js/battle/magicSystem.js"></script>
<script src="js/battle/battleUI.js"></script>
<script src="js/battle/battleCommands.js"></script>
<script src="js/battle/battleTurns.js"></script>
<script src="js/battle/battleInitializer.js"></script>
<script src="js/battle/battleEnd.js"></script>

<!-- メイン制御 -->
<script src="js/main.js"></script>

</body>
</html>
