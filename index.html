<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>魔の山</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="game-container">
    <div id="start-screen" class="screen active">
        <div class="ff-window">
            <h1>LEGEND OF INUSARUKIGI</h1>
            <p>仲間を集め、魔王を討て</p>
            <p style="color: #ff0;"></p>
            <p>【Aボタンで開始】</p>
        </div>
    </div>

    <div id="prologue-screen" class="screen">
        <div class="ff-window">
            <div style="font-size: 160px; margin-bottom: 20px;">🕴️</div>
            <p id="prologue-text">「わしは王様じゃ。えっと、、、お主は？」</p>
            <p>【Aボタンで名前を教える】</p>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="ff-window" style="margin-bottom:5px;">
            <span id="area-title">場所</span>
        </div>
        <div id="map-grid"></div>
        <div class="ff-window" style="width: 100%; text-align: left;">
            <div id="st-hp">HP: 100/100</div>
            <div id="st-party">一行: 勇者</div>
        </div>
        <div id="town-actions" style="display:none; margin-top: 10px;">
            <div class="ff-window">宿屋があります</div>
        </div>
    </div>

    <div id="battle-screen" class="screen">
        <div id="battle-log">魔物があらわれた！</div>
        <div class="enemy-area">
            <div id="monster-sprite" class="monster-sprite"></div>
            <div id="monster-name">モンスター</div>
            <div id="enemy-hp-bar" class="enemy-hp-bar hp-bar-container" style="display:none;">
                <div id="enemy-hp-bar-fill" class="hp-bar" style="width: 100%;"></div>
                <div id="enemy-hp-bar-text" class="hp-bar-text">HP: 100/100</div>
            </div>
        </div>
        <div class="battle-ui">
            <div class="ff-window command-box">
                <ul id="command-list" style="margin:0; padding:0;">
                    <li id="cmd-attack" data-command="attack"> たたかう</li>
                    <li id="cmd-magic" data-command="magic"> まほう</li>
                    <li id="cmd-item" data-command="item"> アイテム</li>
                    <li id="cmd-escape" data-command="escape"> にげる</li>
                </ul>
                <ul id="magic-list" style="margin:0; padding:0; display:none;">
                    <!-- 魔法リストは動的に生成 -->
                </ul>
            </div>
            <div class="ff-window status-box" id="party-status-area"></div>
        </div>
    </div>

    <div id="ending-screen" class="screen">
        <div class="ff-window">
            <h1 id="ending-title">HAPPY ENDING</h1>
            <p id="ending-msg">仲間と共に世界を救った！</p>
            <p>平和な日々が戻ってきた...</p>
            <p>【Aボタンでタイトルへ】</p>
        </div>
    </div>

    <div id="custom-dialog-overlay">
        <div class="ff-window dialog-content">
            <div id="dialog-message" style="margin-bottom: 20px; line-height: 1.5;"></div>
            <div id="dialog-footer" style="font-size: 12px; color: #ccc;">[ Aボタンで閉じる ]</div>
        </div>
    </div>
</div>

<!-- はい/いいえモーダルは #game-container 外に配置（102準拠・オープニング/フィールドのflexレイアウト干渉を防ぐ） -->
<div id="yes-no-modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
    <div class="ff-window" style="padding: 30px; text-align: center; max-width: 400px;">
        <div id="yes-no-message" style="margin-bottom: 30px; font-size: 18px; line-height: 1.6;"></div>
        <div style="display: flex; gap: 20px; justify-content: center;">
            <button id="yes-button" style="padding: 15px 30px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">はい</button>
            <button id="no-button" style="padding: 15px 30px; font-size: 16px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">いいえ</button>
        </div>
    </div>
</div>

<!-- BGM管理 -->
<audio id="bgm-title" loop preload="auto">
    <source src="audio/title.mp3.mp3" type="audio/mpeg">
    <source src="audio/title.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-prologue" loop preload="auto">
    <source src="audio/prologue.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-town" loop preload="auto">
    <source src="audio/town.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-field" loop preload="auto">
    <source src="audio/field.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-battle" loop preload="auto">
    <source src="audio/battle.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-boss" loop preload="auto">
    <source src="audio/boss.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-lastboss" loop preload="auto">
    <source src="audio/lassboss.mp3" type="audio/mpeg">
    <source src="audio/boss.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-ending" loop preload="auto">
    <source src="audio/ending.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-catgod" loop preload="auto">
    <source src="audio/catgod.mp3" type="audio/mpeg">
</audio>

<div id="control-panel">
    <div class="d-pad">
        <button class="pad-btn up" onpointerdown="handleMove(0, -1)">▲</button>
        <button class="pad-btn left" onpointerdown="handleMove(-1, 0)">◀</button>
        <button class="pad-btn right" onpointerdown="handleMove(1, 0)">▶</button>
        <button class="pad-btn down" onpointerdown="handleMove(0, 1)">▼</button>
    </div>

    <div class="action-group">
        <button class="circle-btn btn-b" onpointerdown="handleB()">B</button>
        <button class="circle-btn btn-a" onpointerdown="handleA()">A</button>
    </div>
</div>

<!-- JavaScriptファイルの読み込み -->
<script src="js/config.js"></script>
<script src="js/gameState.js"></script>
<script src="js/audio.js"></script>
<script src="js/sfx.js"></script>
<script src="js/ui.js"></script>
<script src="js/map.js"></script>
<script src="js/battle.js"></script>
<script src="js/main.js"></script>

</body>
</html>
